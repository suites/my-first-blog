{% extends 'blog/base.html' %} 
{% load staticfiles %} 
{% block content %}
<section id="page-breadcrumb">
    <div class="vertical-center sun">
        <div class="container">
            <div class="row">
                <div class="action">
                    <div class="col-sm-12">
                        <h1 class="title">정산</h1>
                        <p>빚을 청산할 시간입니다!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section id="services" class="padding wow " data-wow-duration="1000ms" data-wow-delay="300ms">
    <div class="container">
        <a href="{% url 'meeting_list'%}">
            <h1>{{ meeting_model.meeting_date|date:"Y년 M d일" }} {{ meeting_model.location }}</h1>
        </a>

    <button id="submit_btn" class ="btn btn-primary" style="float:right;">저장</button>

    <form method="POST" id="frm" src="">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>차수</th>
                    <th>결제자</th>
                    <th>인원</th>
                    <th>금액</th>
                    <th>개인별 산정금액</th>
                </tr>
            </thead>
            <tbody>
            {% for number in meeting %}

                <tr class="success"  data_id="{{number.id}}">
                    <td>{{ number.meeting_count }}</td>
                    <td>{{ number.deposit_member__name }}</td>
                    <td>{{ number.member_count }}</td>
                    <td>{{ number.total }}</td>
                    <td>{{ number.division }}</td>
                </tr>
                {% for member in member_meeting %}
                    {% if member.id == number.id %}
                        <tr id="member_{{ member.member_meeting__member__id }}" data-member_id = '{{ member.member_meeting__member__id }}'>
                            <td colspan="5" class="inner_{{number.id}}" style="display: none;"  onclick="setTableRowColor('{{ member.member_meeting__member__id }}');">
                                <a href="#">
                                    <div class="inner_{{number.id}}">
                                        {{ member.member_meeting__member__name }}
                                    </div>
                                </a>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            {% endfor %}
            </tbody>
        </table>

    </form>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script>
    $(function(){
        // 슬라이드 내리기
        $('.success').click(function(){
            var data_id = $(this).attr("data_id");
            var dd = $(".inner_"+data_id).data_bool;
            if($(".inner_"+data_id).css("display") == 'none'){
                $(".inner_"+data_id).slideDown();
            }
            else{
                $(".inner_"+data_id).slideUp();
            }
        });

        var member_numbers = new Array();
        $("#submit_btn").click(function(){
            $(".on").each(function(index){
                if($(this).attr("data-member_id")!=null){
                    // 체크된놈들에 있는 member_id를 가져옴
                    member_numbers[index] = $(this).attr("data-member_id");

                    //추후 예상로직  :  대모임번호랑 체크된놈들 member_id로 디비에 입금여부 YN
                    /*
                    * 예상 문제점   :  그냥 한 개 대모임번호에 속해있는 member_id들이라면 문제가 없으나,
                    *               여러 대모임번호에 여러 닝겐들이라면 어느차수에 속한 닝겐들인지 구분해서 form으로 보내주어야함.
                    */
                }
            });
        });
        

    });
   
    // 테이블 로우 선택시 색깔 이벤트
    function setTableRowColor(member_id){
        var tr = "#member_"+member_id;
        if($(tr).hasClass("on")){
            $(tr).removeClass("on");
            $(tr).css("background-color","#f2dede");
        }else{
            $(tr).addClass("on");
            $(tr).css("background-color","#dff0d8");
        }
    }


</script>
</section>
{% endblock content %}